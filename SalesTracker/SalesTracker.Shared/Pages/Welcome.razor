@page "/welcome"
@inject DemoDataService DemoDataService
@inject DemoDataFlagService DemoDataFlagService
@inject NavigationManager Navigation

<PageTitle>Welcome to Sales Tracker</PageTitle>

<div class="welcome-container bg-gradient">
    <div class="welcome-content d-flex flex-column justify-content-center align-items-center min-vh-100 text-center">
        <div class="welcome-card card bg-body-secondary text-body shadow-lg p-5" style="max-width: 500px;">
            <div class="mb-4">
                <img src="_content/SalesTracker.Shared/images/Logo.png" alt="Sales Tracker" width="96" height="96" />
            </div>
            
            <h1 class="mb-3">Welcome to Sales Tracker</h1>
            <p class="text-muted mb-5">Get started by choosing how you'd like to begin</p>

            @if (IsLoading)
            {
                <div class="spinner-border mb-3" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="text-muted">Setting up your data...</p>
            }
            else if (!string.IsNullOrEmpty(ErrorMessage))
            {
                <div class="alert alert-danger mb-4" role="alert">
                    @ErrorMessage
                </div>
                <button class="btn btn-primary w-100" @onclick="RetryLoadDemoData">Try Again</button>
            }
            else
            {
                <div class="d-grid gap-3">
                    <button class="btn btn-primary btn-lg" @onclick="LoadDemoData" disabled="@IsLoading">
                        <span class="me-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-clipboard2-data" viewBox="0 0 16 16">
                                <path d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5z" />
                                <path d="M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5z" />
                                <path d="M10 7a1 1 0 1 1 2 0v5a1 1 0 1 1-2 0zm-6 4a1 1 0 1 1 2 0v1a1 1 0 1 1-2 0zm4-3a1 1 0 0 0-1 1v3a1 1 0 1 0 2 0V9a1 1 0 0 0-1-1" />
                            </svg>
                        </span>
                        Load Sample Data
                    </button>
                    <p class="text-muted small">Explore with pre-loaded sample items and orders</p>

                    <button class="btn btn-outline-primary btn-lg mt-3" @onclick="StartFresh" disabled="@IsLoading">
                        <span class="me-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-stars" viewBox="0 0 16 16">
                                <path d="M7.657 6.247c.11-.33.576-.33.686 0l.645 1.937a2.89 2.89 0 0 0 1.829 1.828l1.936.645c.33.11.33.576 0 .686l-1.937.645a2.89 2.89 0 0 0-1.828 1.829l-.645 1.936a.361.361 0 0 1-.686 0l-.645-1.937a2.89 2.89 0 0 0-1.828-1.828l-1.937-.645a.361.361 0 0 1 0-.686l1.937-.645a2.89 2.89 0 0 0 1.828-1.828zM3.794 1.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387A1.73 1.73 0 0 0 4.593 5.69l-.387 1.162a.217.217 0 0 1-.412 0L3.407 5.69A1.73 1.73 0 0 0 2.31 4.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387A1.73 1.73 0 0 0 3.407 2.31zM10.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.16 1.16 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.16 1.16 0 0 0-.732-.732L9.1 2.137a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732z" />
                            </svg>
                        </span>
                        Start Fresh
                    </button>
                    <p class="text-muted small">Begin with an empty workspace</p>
                </div>
            }
        </div>
    </div>
</div>

@code {
    private bool IsLoading = false;
    private string ErrorMessage = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        // Check if demo data is already loaded
        var demoDataLoaded = await DemoDataService.IsDemoDataLoadedAsync();
        if (demoDataLoaded)
        {
            // Redirect to dashboard if demo data is already loaded
            Navigation.NavigateTo("/dashboard");
        }
    }

    private async Task LoadDemoData()
    {
        try
        {
            IsLoading = true;
            ErrorMessage = string.Empty;

            await DemoDataService.CreateDemoDataAsync();
            Navigation.NavigateTo("/dashboard");
        }
        catch (Exception ex)
        {
            ErrorMessage = $"Failed to load sample data: {ex.Message}";
        }
        finally
        {
            IsLoading = false;
        }
    }

    private void StartFresh()
    {
        Navigation.NavigateTo("/dashboard");
    }

    private async Task RetryLoadDemoData()
    {
        await LoadDemoData();
    }
}
