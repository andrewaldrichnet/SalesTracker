@using SalesTracker.Shared.Models
@inject IImageStorageService ImageStorageService

<div class="item-row" @onclick="HandleClick" style="cursor: pointer;">
    <ItemImageDisplay Image="Item.Images?.FirstOrDefault()" AltText="Item.Name" />

    <div class="item-row-middle">
        <div class="item-row-details">
            <h5 class="item-name">@Item.Name</h5>
            @if (!string.IsNullOrEmpty(Item.Description))
            {
                <p class="item-description">@Item.Description</p>
            }
        </div>

        <div class="item-row-pricing-inventory">
            <div class="price-stack">
                <div class="sale-price">
                    @if (Item.SalePrice.HasValue)
                    {
                        <span>$@Item.SalePrice.Value.ToString("F2")</span>
                    }
                    else
                    {
                        <span class="text-muted">N/A</span>
                    }
                </div>
            <InventoryStatus 
                AllocatedQty="Item.AllocatedInventoryQty"
                CurrentQty="Item.CurrentInventoryQty"
                AvailableQty="Item.AvailableInventoryQty" />
            </div>
        </div>
    </div>

    <div class="item-row-arrow">
        <ArrowRightShortIcon />
    </div>
</div>

@code {
    [Parameter]
    public required Item Item { get; set; }

    [Parameter]
    public EventCallback<Item> OnClick { get; set; }

    private bool IsBackordered => Item.AllocatedInventoryQty > Item.CurrentInventoryQty;

    private async Task HandleClick()
    {
        await OnClick.InvokeAsync(Item);
    }
}
