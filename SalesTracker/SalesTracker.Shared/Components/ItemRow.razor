@using SalesTracker.Shared.Models

<div class="item-row" @onclick="HandleClick" style="cursor: pointer;">
    <div class="item-row-image">
        @if (Item.Images?.Count > 0 && !string.IsNullOrEmpty(Item.Images[0].ImagePath))
        {
            <img src="@Item.Images[0].ImagePath" alt="@Item.Name" class="item-image" />
        }
        else
        {
            <div class="item-image-placeholder">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M14.5 1a1.5 1.5 0 0 1 1.5 1.5v12a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 14.5v-12A1.5 1.5 0 0 1 1.5 1h13zm-13-1A2.5 2.5 0 0 0-1 2.5v12A2.5 2.5 0 0 0 1.5 17h13a2.5 2.5 0 0 0 2.5-2.5v-12A2.5 2.5 0 0 0 14.5 0h-13z"/>
                    <path d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 1 1-.708-.708L9.172 8 7.146 6.146a.5.5 0 1 1 .708-.708l3 3z"/>
                </svg>
            </div>
        }
    </div>

    <div class="item-row-middle">
        <div class="item-row-details">
            <h5 class="item-name">@Item.Name</h5>
            @if (!string.IsNullOrEmpty(Item.Description))
            {
                <p class="item-description">@Item.Description</p>
            }
        </div>

        <div class="item-row-pricing-inventory">
            <div class="price-stack">
                <div class="sale-price">
                    @if (Item.SalePrice.HasValue)
                    {
                        <span>$@Item.SalePrice.Value.ToString("F2")</span>
                    }
                    else
                    {
                        <span class="text-muted">N/A</span>
                    }
                </div>
                <div class="inventory-status">
                    @if (IsBackordered)
                    {
                        <span class="badge bg-danger">Back-ordered</span>
                    }
                    else if (Item.AvailableInventoryQty > 0)
                    {
                        <span class="inventory-count">@Item.AvailableInventoryQty in stock</span>
                    }
                    else
                    {
                        <span class="badge bg-secondary">Out of stock</span>
                    }
                </div>
            </div>
        </div>
    </div>

    <div class="item-row-arrow">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/>
        </svg>
    </div>
</div>

@code {
    [Parameter]
    public required Item Item { get; set; }

    [Parameter]
    public EventCallback<Item> OnClick { get; set; }

    private bool IsBackordered => Item.AllocatedInventoryQty > Item.CurrentInventoryQty;

    private async Task HandleClick()
    {
        await OnClick.InvokeAsync(Item);
    }
}
